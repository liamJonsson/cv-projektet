@model IEnumerable<MyApp.Models.User>

<div class="d-flex justify-content-center" style="width: 90%; margin: 50px 0">
    <form asp-action="Index" method="get">
        <label class="fs-5" for="search">Hitta användare</label>
        @* Andra border color på input fältet när man klickat i den samt ändra storleken på fältet *@
        <input class="ms-2 border-0 bg-light" style="width: 400px;" type="search" id="search" name="query" placeholder="Sök användare..." />
        @*Flytta på sökikonen*@
        <button class="ms-2 border-0" type="submit" aria-label="Sök">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-search" viewBox="0 0 14 14">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
            </svg>
        </button>
    </form>
</div>

@foreach (var item in Model)
{
    bool isLoggedIn = User.Identity != null && User.Identity.IsAuthenticated;
    @if (isLoggedIn || item.Visibility == true)
    {
        var latestProject = item.ParticipatingProjects
            .Where(pp => pp.Project != null)
            .OrderByDescending(pp => pp.Project.EndDate)
            .FirstOrDefault();
    
        <h3>@item.Name</h3>
        <div class="d-flex" style="width: 90%; margin-bottom: 20px;">
            <div class="bg-light p-2" style="width: 47%; margin-right: 6%;">
                <div style="width: 96%; margin: 0 auto; overflow-wrap: break-word;">
                    <h4>CV</h4>
                    @{
                        var filePath = "wwwroot/cv/" + item.Cv;
                    }

                    @if (!string.IsNullOrEmpty(item.Cv) && System.IO.File.Exists(filePath))
                    {
                        <iframe src="~/cv/@item.Cv"
                                style="width:100%; height:100vh; border:none;">
                        </iframe>
                    }
                    else
                    {
                        <p>Inget CV är uppladdat</p>
                    }
                </div>
            </div>
            <div class="bg-light p-2" style="width: 47%;">
                <div style="width: 96%; margin: 0 auto; overflow-wrap: break-word;">
                    <h4>Senaste projekt</h4>
                    @if (latestProject != null)
                    {
                        <p class="fst-italic">@latestProject.Project.Title</p>
                        <p>@latestProject.Project.Description</p>
                        <p>Programmeringsspråk: @latestProject.Project.CodeLanguage</p>
                        <p>
                            @*Join är en inbyggs metod i string-klassen och gör flera strängar till en sträng
                        , " ," indikerar på att varje sträng ska separeras med ett kommatecken 
                        och resten hämtar namnet på alla deltagarna i ett specifikt projekt!*@
                            Deltagare: @string.Join(", ", latestProject.Project.Participants
                                        .Select(p => p.User.Name))
                        </p>
                        <p>Skapad av: @latestProject.Project.Creator.Name</p>
                        <p>
                            @latestProject.Project.ZipFile
                            <a href="~/uploads/@latestProject.Project.ZipFile" download class="ps-1 text-decoration-underline">
                                Ladda ner zip
                            </a>
                        </p>
                    }
                    else
                    {
                        <p>Inga projekt ännu</p>
                    }
                </div>
            </div>
        </div>
        <div style="width: 90%; text-align: right;">
            @if (isLoggedIn)
            {
                <a asp-controller="User"
                   asp-action="MyPage"
                   asp-route-id="@item.Id"
                   class="btn btn-light">
                    Se profil
                </a>
            }
            else
            {
                <a asp-controller="User"
                   asp-action="Login"
                   class="btn btn-light">
                    Se profil
                </a>
            }
        </div>
    }
}

